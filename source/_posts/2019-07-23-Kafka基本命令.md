---
title: Kafka基本命令
date: 2019-07-23 16:19:38
categories:
- Technology
tags:
- Kafka
---

## 1.kafka-topic

### 创建话题

```shell
bin/kafka-topics.sh --create --topic test --replication-factor 1 --partitions 3 --zookeeper localhost:2181
```

### 删除话题

```shell
bin/kafka-topics.sh --zookeeper emr-header-1:2181 --delete --topic flume_test3
```

### 查看topic信息

```shell
bin/kafka-topics.sh --zookeeper kafka1.tanwan.com:2181 --describe --topic loginLogSource
-------------------------------------------------------------------------------------
Topic:loginLogSource    PartitionCount:60       ReplicationFactor:3     Configs:min.insync.replicas=2,preallocate=true
    Topic: loginLogSource   Partition: 0    Leader: 167     Replicas: 167,165,166   Isr: 167,165,166
    Topic: loginLogSource   Partition: 1    Leader: 165     Replicas: 165,166,167   Isr: 167,166,165
    Topic: loginLogSource   Partition: 2    Leader: 166     Replicas: 166,167,165   Isr: 167,166,165
    Topic: loginLogSource   Partition: 3    Leader: 167     Replicas: 167,166,165   Isr: 167,166,165
    Topic: loginLogSource   Partition: 4    Leader: 165     Replicas: 165,167,166   Isr: 167,165,166
```

## 2.kafka-console-consumer

### 控制台消费者

```shell
bin/kafka-console-consumer.sh --bootstrap-server=kafka1.tanwan.com:9092 --topic loginLogSource --from-beginning --consumer-property group.id=test_82cf1c1c-72c5-4e6f-8018-bf52ed0577e3
```

## 3.kafka-console-producer

### 控制台生产者

```shell
bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test
```

## 4.kafka-consumer-groups

### 查看某组的offset

```shell
bin/kafka-consumer-groups.sh --bootstrap-server  kafka1.tanwan.com:9092 --describe --group test_82cf1c1c-72c5-4e6f-8018-bf52ed0577e3
-------------------------------------------------------------------------------------
GROUP                          				   TOPIC        		  PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  	   LAG             OWNER
test_82cf1c1c-72c5-4e6f-8018-bf52ed0577e32 loginLogSource                 0          6418677         8164343         1745666         consumer-1_/14.23.149.188
test_82cf1c1c-72c5-4e6f-8018-bf52ed0577e32 loginLogSource                 1          6415908         8162106         1746198         consumer-1_/14.23.149.188
test_82cf1c1c-72c5-4e6f-8018-bf52ed0577e32 loginLogSource                 2          6411723         8157118         1745395         consumer-1_/14.23.149.188
```



### 重置消费者offset

```shell
bin/kafka-consumer-groups.sh --bootstrap-server kafka1.tanwan.com:9092 --group test_82cf1c1c-72c5-4e6f-8018-bf52ed0577e3 --reset-offsets --to-offset 0 --topic loginLogSource --execute
-------------------------------------------------------------------------------------
[2019-06-12 00:15:17,433] WARN New offset (0) is lower than earliest offset for topic partition loginLogSource-11. Value will be set to 6416005 (kafka.admin.ConsumerGroupCommand$)
[2019-06-12 00:15:17,433] WARN New offset (0) is lower than earliest offset for topic partition loginLogSource-4. Value will be set to 6416083 (kafka.admin.ConsumerGroupCommand$)
[2019-06-12 00:15:17,434] WARN New offset (0) is lower than earliest offset for topic partition loginLogSource-59. Value will be set to 6418753 (kafka.admin.ConsumerGroupCommand$)
[2019-06-12 00:15:17,434] WARN New offset (0) is lower than earliest offset for topic partition loginLogSource-46. Value will be set to 6415107 (kafka.admin.ConsumerGroupCommand$)
..............
TOPIC                          PARTITION  NEW-OFFSET
loginLogSource                 11         6416005
loginLogSource                 4          6416083
loginLogSource                 59         6418753
loginLogSource                 46         6415107
loginLogSource                 53         6413193
loginLogSource                 55         6418041
loginLogSource                 41         6422387
```

### 查看消费者组列表(新版本，保存在broker服务器上)

```shell
bin/kafka-consumer-groups.sh --bootstrap-server kafka1.tanwan.com:9092 --list
-------------------------------------------------------------------------------------
	gameDataRole
	test
	gameReg
	f19b1ee0-cc0f-498c-b512-5543ddeb3235
	c3e1b9d8-b331-4234-a206-dad11a257813
	5d821cab-4d13-432b-aa05-8a34782fde0b
	gameRoleInfo
	kmf-consumer-group--2145004575
	login
	3f141b56-aaa8-46fa-a0ad-ed5b87fd4084
	test_82cf1c1c-72c5-4e6f-8018-bf52ed0577e32
	agentMatch
	connect-elasticsearch-sink
	gameRoleInfoPayList
	payList3
	5962df48-92ec-4988-a6d7-68691baa235f
	loginReg
	test_82cf1c1c-72c5-4e6f-8018-bf52ed0577e3
```

## 5.kafka-run-class

### 查询offset的最大值(latest)

```shell
bin/kafka-run-class.sh kafka.tools.GetOffsetShell --broker-list kafka1.tanwan.com:9092 -topic loginLogSource --time -1
-------------------------------------------------------------------------------------
loginLogSource:0:8190820
loginLogSource:10:8194471
loginLogSource:20:8184116
loginLogSource:40:8192889
```

### 查询offset的最小值（earliest）

```shell
bin/kafka-run-class.sh kafka.tools.GetOffsetShell --broker-list kafka1.tanwan.com:9092 -topic loginLogSource --time -2
-------------------------------------------------------------------------------------
loginLogSource:0:6418677
loginLogSource:10:6421082
loginLogSource:20:6410858
loginLogSource:40:6419693
loginLogSource:30:6412937
loginLogSource:50:6413748
loginLogSource:9:6415801
loginLogSource:59:6418753
```



### 更新Zookeeper中指定Topic所有分区的偏移量(可以指定成 earliest或者latest)

```shell
bin/kafka-run-class.sh kafka.tools.UpdateOffsetsInZK earliest config/consumer.properties  loginLogSource
-------------------------------------------------------------------------------------
updating partition 0 with new offset: 6418677
updating partition 1 with new offset: 6415908
updating partition 2 with new offset: 6411723
updating partition 3 with new offset: 6418196
updating partition 4 with new offset: 6416083
updating partition 5 with new offset: 6411995
updating partition 6 with new offset: 6419059
updating partition 7 with new offset: 6419302
updating partition 8 with new offset: 6417078
updating partition 9 with new offset: 6415801
```

